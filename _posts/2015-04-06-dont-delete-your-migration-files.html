---
layout: post
title: Don't delete your migration files!
date: '2015-04-06T14:30:00.000-07:00'
author: Mark J. Lehman
tags:
- rails
- ruby
modified_time: '2015-08-21T10:08:38.663-07:00'
blogger_id: tag:blogger.com,1999:blog-4459370175540830177.post-3087016497935859608
blogger_orig_url: http://spaghettirefactory.blogspot.com/2015/04/dont-delete-your-migration-files.html
---

<span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;">This is probably Rails 101 but this is something that I just had the extreme displeasure to experience, so I felt the need to comment.&nbsp;</span><br /><b style="color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;"><br /></b><b style="color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;">Exercise EXTREME caution when deleting a migration that has been deployed.</b><span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;">&nbsp;</span><br /><span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;"><b><br /></b></span><span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;"><b>This can seriously mess up your database.</b></span><br /><span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;"><b><br /></b></span><span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;">I recently took over a project where the previous developer had two differently-named migration files trying to add the same column to the same table in the database, and it was messing things up. However, the first (incorrectly-named) file had already been migrated, leaving DuplicateColumn errors when trying to migrate the database when it got to the next migration. Since the first file was the one that was incorrectly named, I deleted that one. Unfortunately, that one had already been deployed to staging, so when I tried to migrate on the staging server, it still gave me a DuplicateColumn error because it saw the duplicate migration as a new migration that needed to run, and the first column was still in the schema.</span><br /><span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;"><br /></span><span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;">Long story short (is that still possible?), I had to re-create the incorrectly-named migration file and remove the second migration file that was doing the same thing instead. Then, since I'm a teensy bit OCD and I don't like have migration files with incorrect names, I wrote a new migration to remove the column, migrated to update the schema, then deleted both migration files and created one last one that would add that needed column back into the database schema.</span><br /><span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;"><br /></span><span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 12.8000001907349px;">Needless to say, it was a huge hassle, and the moral of the story is: <b>Be Very Careful Deleting Deployed Migrations</b>.</span>